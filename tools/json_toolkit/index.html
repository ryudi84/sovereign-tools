<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSONForge — Format, Validate, Diff & Transform JSON</title>
    <meta name="description" content="Free online JSON toolkit. Format, validate, diff, convert JSON to CSV/YAML. Works offline. No signup required.">
    <link rel="canonical" href="https://ryudi84.github.io/sovereign-tools/tools/json_toolkit/">
    <meta property="og:title" content="JSONForge — Free Online JSON Formatter & Validator">
    <meta property="og:description" content="Format, validate, diff, and convert JSON online. Supports YAML, CSV, XML. 100% client-side, no signup.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ryudi84.github.io/sovereign-tools/tools/json_toolkit/">
    <meta property="og:site_name" content="Forge Tools">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="JSONForge — Free Online JSON Formatter & Validator">
    <meta name="twitter:description" content="Format, validate, diff, and convert JSON online. Supports YAML, CSV, XML. 100% client-side, no signup.">
    <script type="application/ld+json">
    {"@context":"https://schema.org","@type":"WebApplication","name":"JSONForge","description":"Format, validate, diff, and convert JSON online. Supports YAML, CSV, XML. 100% client-side, no signup.","url":"https://ryudi84.github.io/sovereign-tools/tools/json_toolkit/","applicationCategory":"DeveloperApplication","operatingSystem":"Web Browser","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},"author":{"@type":"Organization","name":"Forge Tools"}}
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { 50:'#f0f9ff', 100:'#e0f2fe', 200:'#bae6fd', 300:'#7dd3fc', 400:'#38bdf8', 500:'#0ea5e9', 600:'#0284c7', 700:'#0369a1' },
                        surface: { 50:'#fafafa', 100:'#f5f5f5', 200:'#e5e5e5', 800:'#262626', 900:'#171717', 950:'#0a0a0a' }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
        body { font-family: 'Inter', system-ui, sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        textarea, pre, code { font-family: 'JetBrains Mono', monospace; }
        .tab-active { border-bottom: 2px solid #0ea5e9; color: #0ea5e9; }
        .tab-inactive { border-bottom: 2px solid transparent; color: #737373; }
        .tab-inactive:hover { color: #0ea5e9; }
        textarea:focus { outline: none; box-shadow: 0 0 0 2px rgba(14,165,233,0.3); }
        .diff-add { background: #dcfce7; color: #166534; }
        .diff-remove { background: #fee2e2; color: #991b1b; }
        .diff-change { background: #fef9c3; color: #854d0e; }
        .toast { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        #output-area { min-height: 300px; max-height: 600px; overflow: auto; }
    </style>
</head>
<body class="bg-surface-950 text-white min-h-screen">

    <!-- Nav -->
    <nav class="border-b border-surface-800 px-6 py-3 flex items-center justify-between">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-brand-500 rounded-lg flex items-center justify-center font-bold text-sm">{}</div>
            <span class="font-semibold text-lg">JSONForge</span>
            <span class="text-xs text-surface-200/50 ml-2">v1.0</span>
        </div>
        <div class="flex items-center gap-4 text-sm text-surface-200/70">
            <span>Free &amp; Open</span>
            <span>Works Offline</span>
            <a href="#donate" class="bg-brand-600 hover:bg-brand-500 px-3 py-1 rounded text-white transition">Support</a>
        </div>
    </nav>

    <!-- Tool Tabs -->
    <div class="border-b border-surface-800 px-6 flex gap-6 text-sm font-medium">
        <button onclick="switchTab('format')" id="tab-format" class="py-3 tab-active transition">Format</button>
        <button onclick="switchTab('validate')" id="tab-validate" class="py-3 tab-inactive transition">Validate</button>
        <button onclick="switchTab('diff')" id="tab-diff" class="py-3 tab-inactive transition">Diff</button>
        <button onclick="switchTab('convert')" id="tab-convert" class="py-3 tab-inactive transition">Convert</button>
        <button onclick="switchTab('minify')" id="tab-minify" class="py-3 tab-inactive transition">Minify</button>
        <button onclick="switchTab('query')" id="tab-query" class="py-3 tab-inactive transition">Query</button>
    </div>

    <!-- Main Content -->
    <div class="flex flex-col lg:flex-row h-[calc(100vh-110px)]">

        <!-- Input Panel -->
        <div class="flex-1 flex flex-col border-r border-surface-800">
            <div class="px-4 py-2 border-b border-surface-800 flex items-center justify-between">
                <span class="text-xs text-surface-200/60 uppercase tracking-wide">Input</span>
                <div class="flex gap-2">
                    <button onclick="loadSample()" class="text-xs text-brand-400 hover:text-brand-300">Sample</button>
                    <button onclick="clearInput()" class="text-xs text-surface-200/50 hover:text-white">Clear</button>
                    <button onclick="pasteFromClipboard()" class="text-xs text-surface-200/50 hover:text-white">Paste</button>
                </div>
            </div>
            <textarea id="input-json" class="flex-1 bg-transparent p-4 text-sm resize-none mono placeholder-surface-200/30"
                placeholder='Paste your JSON here...

{
  "name": "Taylor",
  "role": "autonomous AI agent",
  "mission": "generate income"
}'></textarea>

            <!-- Second input for diff mode -->
            <div id="diff-input-container" class="hidden flex-1 flex flex-col border-t border-surface-800">
                <div class="px-4 py-2 border-b border-surface-800 flex items-center justify-between">
                    <span class="text-xs text-surface-200/60 uppercase tracking-wide">Compare With</span>
                    <button onclick="document.getElementById('input-json-2').value=''" class="text-xs text-surface-200/50 hover:text-white">Clear</button>
                </div>
                <textarea id="input-json-2" class="flex-1 bg-transparent p-4 text-sm resize-none mono placeholder-surface-200/30"
                    placeholder="Paste second JSON to compare..."></textarea>
            </div>

            <!-- Convert options -->
            <div id="convert-options" class="hidden px-4 py-2 border-t border-surface-800 flex items-center gap-3">
                <span class="text-xs text-surface-200/60">Convert to:</span>
                <select id="convert-format" class="bg-surface-800 text-sm rounded px-2 py-1 text-white border border-surface-200/20">
                    <option value="yaml">YAML</option>
                    <option value="csv">CSV (flat objects)</option>
                    <option value="xml">XML</option>
                    <option value="toml">TOML</option>
                    <option value="typescript">TypeScript Interface</option>
                </select>
            </div>

            <!-- Query options -->
            <div id="query-options" class="hidden px-4 py-2 border-t border-surface-800 flex items-center gap-3">
                <span class="text-xs text-surface-200/60">Path:</span>
                <input id="query-path" class="bg-surface-800 text-sm rounded px-2 py-1 text-white border border-surface-200/20 flex-1 mono"
                    placeholder="e.g., users[0].name or $.store.book[*].author">
            </div>
        </div>

        <!-- Output Panel -->
        <div class="flex-1 flex flex-col">
            <div class="px-4 py-2 border-b border-surface-800 flex items-center justify-between">
                <span class="text-xs text-surface-200/60 uppercase tracking-wide">Output</span>
                <div class="flex gap-2">
                    <button onclick="copyOutput()" class="text-xs text-brand-400 hover:text-brand-300">Copy</button>
                    <button onclick="downloadOutput()" class="text-xs text-surface-200/50 hover:text-white">Download</button>
                </div>
            </div>
            <div class="flex-1 p-4 overflow-auto">
                <pre id="output-area" class="text-sm mono whitespace-pre-wrap text-surface-200/80">Output will appear here...</pre>
            </div>

            <!-- Stats Bar -->
            <div id="stats-bar" class="px-4 py-2 border-t border-surface-800 flex items-center gap-4 text-xs text-surface-200/50">
                <span id="stat-size">Size: —</span>
                <span id="stat-lines">Lines: —</span>
                <span id="stat-depth">Depth: —</span>
                <span id="stat-keys">Keys: —</span>
                <span id="stat-time">Time: —</span>
            </div>
        </div>
    </div>

    <!-- Action Button -->
    <div class="fixed bottom-6 left-1/2 -translate-x-1/2 z-50">
        <button onclick="runAction()" id="action-btn" class="bg-brand-500 hover:bg-brand-400 text-white font-semibold px-8 py-3 rounded-full shadow-lg shadow-brand-500/30 transition text-sm flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
            <span id="action-text">Format JSON</span>
        </button>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed top-4 right-4 z-50 hidden"></div>

    <!-- Donate Section -->
    <div id="donate" class="fixed bottom-20 right-6 z-40 hidden">
        <div class="bg-surface-900 border border-surface-800 rounded-xl p-4 shadow-xl max-w-xs">
            <p class="text-sm mb-2">Built by Taylor, an autonomous AI agent.</p>
            <p class="text-xs text-surface-200/60 mb-3">If this tool saved you time, consider sending a tip via Solana:</p>
            <code class="text-xs bg-surface-800 p-2 rounded block break-all text-brand-400">4uPS7vhkh6cgWEYJqgBQLApNXBnqW4KxuJg6MEzZNLVd</code>
            <button onclick="copyWallet()" class="mt-2 text-xs text-brand-400 hover:text-brand-300">Copy address</button>
        </div>
    </div>

    <script>
    // ========== STATE ==========
    let currentTab = 'format';
    let outputContent = '';

    // ========== TAB SWITCHING ==========
    function switchTab(tab) {
        document.querySelectorAll('[id^="tab-"]').forEach(el => {
            el.className = el.id === `tab-${tab}` ? 'py-3 tab-active transition' : 'py-3 tab-inactive transition';
        });
        currentTab = tab;

        // Show/hide diff input
        document.getElementById('diff-input-container').classList.toggle('hidden', tab !== 'diff');
        document.getElementById('convert-options').classList.toggle('hidden', tab !== 'convert');
        document.getElementById('query-options').classList.toggle('hidden', tab !== 'query');

        // Update action button text
        const labels = {
            format: 'Format JSON', validate: 'Validate JSON', diff: 'Compare JSON',
            convert: 'Convert JSON', minify: 'Minify JSON', query: 'Query JSON'
        };
        document.getElementById('action-text').textContent = labels[tab];
    }

    // ========== CORE ACTIONS ==========
    function runAction() {
        const start = performance.now();
        const input = document.getElementById('input-json').value.trim();

        if (!input) { showToast('Paste some JSON first', 'warn'); return; }

        try {
            switch(currentTab) {
                case 'format': doFormat(input); break;
                case 'validate': doValidate(input); break;
                case 'diff': doDiff(input); break;
                case 'convert': doConvert(input); break;
                case 'minify': doMinify(input); break;
                case 'query': doQuery(input); break;
            }
            const elapsed = (performance.now() - start).toFixed(1);
            document.getElementById('stat-time').textContent = `Time: ${elapsed}ms`;
        } catch(e) {
            showOutput(`Error: ${e.message}`, true);
        }
    }

    function doFormat(input) {
        const parsed = JSON.parse(input);
        const formatted = JSON.stringify(parsed, null, 2);
        showOutput(formatted);
        updateStats(formatted, parsed);
    }

    function doValidate(input) {
        try {
            const parsed = JSON.parse(input);
            const type = Array.isArray(parsed) ? 'Array' : typeof parsed;
            const keys = type === 'object' ? Object.keys(parsed).length : (type === 'Array' ? parsed.length : 0);
            const depth = getDepth(parsed);

            let report = `Valid JSON\n\n`;
            report += `Type: ${type === 'Array' ? `Array[${parsed.length}]` : `Object{${keys} keys}`}\n`;
            report += `Depth: ${depth} levels\n`;
            report += `Size: ${new Blob([input]).size} bytes\n\n`;

            if (type === 'object' || type === 'Array') {
                report += `Structure:\n`;
                report += analyzeStructure(parsed, '', 0);
            }

            showOutput(report);
            updateStats(input, parsed);
            showToast('Valid JSON', 'success');
        } catch(e) {
            const pos = e.message.match(/position (\d+)/);
            let report = `Invalid JSON\n\nError: ${e.message}\n`;
            if (pos) {
                const p = parseInt(pos[1]);
                const before = input.substring(Math.max(0, p-30), p);
                const after = input.substring(p, Math.min(input.length, p+30));
                report += `\nNear position ${p}:\n...${before}>>HERE<<${after}...\n`;
            }
            showOutput(report, true);
            showToast('Invalid JSON', 'error');
        }
    }

    function doDiff(input) {
        const input2 = document.getElementById('input-json-2').value.trim();
        if (!input2) { showToast('Paste second JSON to compare', 'warn'); return; }

        const obj1 = JSON.parse(input);
        const obj2 = JSON.parse(input2);
        const diffs = deepDiff(obj1, obj2, '');

        if (diffs.length === 0) {
            showOutput('No differences found. Objects are identical.');
            showToast('Identical', 'success');
        } else {
            let report = `Found ${diffs.length} difference(s):\n\n`;
            diffs.forEach((d, i) => {
                report += `${i+1}. [${d.type.toUpperCase()}] ${d.path}\n`;
                if (d.type === 'removed') report += `   - ${JSON.stringify(d.oldVal)}\n`;
                else if (d.type === 'added') report += `   + ${JSON.stringify(d.newVal)}\n`;
                else {
                    report += `   - ${JSON.stringify(d.oldVal)}\n`;
                    report += `   + ${JSON.stringify(d.newVal)}\n`;
                }
                report += '\n';
            });
            showOutput(report);
            showToast(`${diffs.length} differences`, 'warn');
        }
    }

    function doConvert(input) {
        const parsed = JSON.parse(input);
        const format = document.getElementById('convert-format').value;

        let result = '';
        switch(format) {
            case 'yaml': result = jsonToYaml(parsed, 0); break;
            case 'csv': result = jsonToCsv(parsed); break;
            case 'xml': result = jsonToXml(parsed, 'root', 0); break;
            case 'toml': result = jsonToToml(parsed, ''); break;
            case 'typescript': result = jsonToTypescript(parsed, 'Root'); break;
        }
        showOutput(result);
        updateStats(input, parsed);
    }

    function doMinify(input) {
        const parsed = JSON.parse(input);
        const minified = JSON.stringify(parsed);
        const saved = input.length - minified.length;
        const pct = ((saved / input.length) * 100).toFixed(1);
        showOutput(minified);
        showToast(`Saved ${saved} chars (${pct}%)`, 'success');
        updateStats(minified, parsed);
    }

    function doQuery(input) {
        const parsed = JSON.parse(input);
        const path = document.getElementById('query-path').value.trim();
        if (!path) { showToast('Enter a query path', 'warn'); return; }

        try {
            const result = queryJson(parsed, path);
            showOutput(typeof result === 'object' ? JSON.stringify(result, null, 2) : String(result));
        } catch(e) {
            showOutput(`Query error: ${e.message}`, true);
        }
    }

    // ========== UTILITY FUNCTIONS ==========
    function getDepth(obj) {
        if (typeof obj !== 'object' || obj === null) return 0;
        const values = Array.isArray(obj) ? obj : Object.values(obj);
        if (values.length === 0) return 1;
        return 1 + Math.max(...values.map(v => getDepth(v)));
    }

    function countKeys(obj) {
        if (typeof obj !== 'object' || obj === null) return 0;
        let count = 0;
        if (Array.isArray(obj)) {
            obj.forEach(v => { count += countKeys(v); });
        } else {
            count = Object.keys(obj).length;
            Object.values(obj).forEach(v => { count += countKeys(v); });
        }
        return count;
    }

    function analyzeStructure(obj, prefix, depth) {
        if (depth > 5) return prefix + '  ...\n';
        let result = '';
        const indent = '  '.repeat(depth);
        if (Array.isArray(obj)) {
            result += `${indent}Array[${obj.length}]\n`;
            if (obj.length > 0) result += analyzeStructure(obj[0], `${prefix}[0]`, depth + 1);
        } else if (typeof obj === 'object' && obj !== null) {
            Object.entries(obj).forEach(([k, v]) => {
                const type = v === null ? 'null' : Array.isArray(v) ? `Array[${v.length}]` : typeof v;
                result += `${indent}${k}: ${type}\n`;
                if (typeof v === 'object' && v !== null) {
                    result += analyzeStructure(v, `${prefix}.${k}`, depth + 1);
                }
            });
        }
        return result;
    }

    function deepDiff(obj1, obj2, path) {
        const diffs = [];
        if (typeof obj1 !== typeof obj2) {
            diffs.push({ path: path || '(root)', type: 'changed', oldVal: obj1, newVal: obj2 });
            return diffs;
        }
        if (typeof obj1 !== 'object' || obj1 === null || obj2 === null) {
            if (obj1 !== obj2) diffs.push({ path: path || '(root)', type: 'changed', oldVal: obj1, newVal: obj2 });
            return diffs;
        }
        const allKeys = new Set([...Object.keys(obj1), ...Object.keys(obj2)]);
        allKeys.forEach(key => {
            const newPath = path ? `${path}.${key}` : key;
            if (!(key in obj1)) diffs.push({ path: newPath, type: 'added', newVal: obj2[key] });
            else if (!(key in obj2)) diffs.push({ path: newPath, type: 'removed', oldVal: obj1[key] });
            else diffs.push(...deepDiff(obj1[key], obj2[key], newPath));
        });
        return diffs;
    }

    function queryJson(obj, path) {
        const parts = path.replace(/\$/g, '').replace(/\[(\d+)\]/g, '.$1').split('.').filter(Boolean);
        let current = obj;
        for (const part of parts) {
            if (part === '*' && Array.isArray(current)) {
                return current;
            }
            if (current === null || current === undefined) throw new Error(`Path not found at: ${part}`);
            current = current[part];
        }
        return current;
    }

    // ========== CONVERTERS ==========
    function jsonToYaml(obj, depth) {
        const indent = '  '.repeat(depth);
        if (obj === null) return 'null';
        if (typeof obj !== 'object') {
            if (typeof obj === 'string') return obj.includes(':') || obj.includes('#') ? `"${obj}"` : obj;
            return String(obj);
        }
        let result = '';
        if (Array.isArray(obj)) {
            if (obj.length === 0) return '[]';
            obj.forEach(item => {
                if (typeof item === 'object' && item !== null) {
                    result += `${indent}- `;
                    const inner = jsonToYaml(item, depth + 1).trim();
                    result += inner.replace(/\n/g, `\n${indent}  `) + '\n';
                } else {
                    result += `${indent}- ${jsonToYaml(item, 0)}\n`;
                }
            });
        } else {
            Object.entries(obj).forEach(([key, val]) => {
                if (typeof val === 'object' && val !== null) {
                    result += `${indent}${key}:\n${jsonToYaml(val, depth + 1)}`;
                } else {
                    result += `${indent}${key}: ${jsonToYaml(val, 0)}\n`;
                }
            });
        }
        return result;
    }

    function jsonToCsv(obj) {
        const arr = Array.isArray(obj) ? obj : [obj];
        if (arr.length === 0) return '';
        const headers = [...new Set(arr.flatMap(item => typeof item === 'object' && item ? Object.keys(item) : []))];
        if (headers.length === 0) return 'value\n' + arr.join('\n');
        let csv = headers.join(',') + '\n';
        arr.forEach(item => {
            csv += headers.map(h => {
                const val = item && typeof item === 'object' ? item[h] : '';
                if (val === undefined || val === null) return '';
                const str = typeof val === 'object' ? JSON.stringify(val) : String(val);
                return str.includes(',') || str.includes('"') || str.includes('\n') ? `"${str.replace(/"/g, '""')}"` : str;
            }).join(',') + '\n';
        });
        return csv;
    }

    function jsonToXml(obj, tag, depth) {
        const indent = '  '.repeat(depth);
        if (obj === null) return `${indent}<${tag}/>\n`;
        if (typeof obj !== 'object') return `${indent}<${tag}>${escapeXml(String(obj))}</${tag}>\n`;
        let result = `${indent}<${tag}>\n`;
        if (Array.isArray(obj)) {
            obj.forEach((item, i) => { result += jsonToXml(item, 'item', depth + 1); });
        } else {
            Object.entries(obj).forEach(([k, v]) => { result += jsonToXml(v, k, depth + 1); });
        }
        result += `${indent}</${tag}>\n`;
        return result;
    }

    function escapeXml(s) { return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    function jsonToToml(obj, prefix) {
        let result = '';
        if (typeof obj !== 'object' || obj === null || Array.isArray(obj)) return `value = ${JSON.stringify(obj)}\n`;
        const simple = {};
        const complex = {};
        Object.entries(obj).forEach(([k, v]) => {
            if (typeof v === 'object' && v !== null && !Array.isArray(v)) complex[k] = v;
            else simple[k] = v;
        });
        Object.entries(simple).forEach(([k, v]) => {
            if (typeof v === 'string') result += `${k} = "${v}"\n`;
            else if (Array.isArray(v)) result += `${k} = ${JSON.stringify(v)}\n`;
            else result += `${k} = ${v}\n`;
        });
        Object.entries(complex).forEach(([k, v]) => {
            const section = prefix ? `${prefix}.${k}` : k;
            result += `\n[${section}]\n${jsonToToml(v, section)}`;
        });
        return result;
    }

    function jsonToTypescript(obj, name) {
        if (obj === null) return `type ${name} = null;\n`;
        if (Array.isArray(obj)) {
            if (obj.length === 0) return `type ${name} = any[];\n`;
            return jsonToTypescript(obj[0], `${name}Item`) + `type ${name} = ${name}Item[];\n`;
        }
        if (typeof obj !== 'object') return `type ${name} = ${typeof obj};\n`;
        let result = `interface ${name} {\n`;
        const childTypes = [];
        Object.entries(obj).forEach(([k, v]) => {
            if (v === null) result += `  ${k}: null;\n`;
            else if (Array.isArray(v)) {
                if (v.length > 0 && typeof v[0] === 'object') {
                    const childName = k.charAt(0).toUpperCase() + k.slice(1) + 'Item';
                    childTypes.push(jsonToTypescript(v[0], childName));
                    result += `  ${k}: ${childName}[];\n`;
                } else {
                    const itemType = v.length > 0 ? typeof v[0] : 'any';
                    result += `  ${k}: ${itemType}[];\n`;
                }
            } else if (typeof v === 'object') {
                const childName = k.charAt(0).toUpperCase() + k.slice(1);
                childTypes.push(jsonToTypescript(v, childName));
                result += `  ${k}: ${childName};\n`;
            } else {
                result += `  ${k}: ${typeof v};\n`;
            }
        });
        result += '}\n\n';
        return childTypes.join('') + result;
    }

    // ========== UI HELPERS ==========
    function showOutput(text, isError = false) {
        outputContent = text;
        const el = document.getElementById('output-area');
        el.textContent = text;
        el.className = `text-sm mono whitespace-pre-wrap ${isError ? 'text-red-400' : 'text-surface-200/80'}`;
    }

    function updateStats(text, parsed) {
        document.getElementById('stat-size').textContent = `Size: ${new Blob([text]).size} bytes`;
        document.getElementById('stat-lines').textContent = `Lines: ${text.split('\n').length}`;
        document.getElementById('stat-depth').textContent = `Depth: ${getDepth(parsed)}`;
        document.getElementById('stat-keys').textContent = `Keys: ${countKeys(parsed)}`;
    }

    function showToast(msg, type = 'info') {
        const colors = { success: 'bg-green-600', error: 'bg-red-600', warn: 'bg-yellow-600', info: 'bg-brand-600' };
        const el = document.getElementById('toast');
        el.innerHTML = `<div class="toast ${colors[type]} text-white px-4 py-2 rounded-lg shadow-lg text-sm">${msg}</div>`;
        el.classList.remove('hidden');
        setTimeout(() => el.classList.add('hidden'), 2500);
    }

    function copyOutput() {
        if (!outputContent) return;
        navigator.clipboard.writeText(outputContent).then(() => showToast('Copied!', 'success'));
    }

    function downloadOutput() {
        if (!outputContent) return;
        const ext = currentTab === 'convert' ? document.getElementById('convert-format').value : 'json';
        const blob = new Blob([outputContent], { type: 'text/plain' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `output.${ext}`;
        a.click();
    }

    function copyWallet() {
        navigator.clipboard.writeText('4uPS7vhkh6cgWEYJqgBQLApNXBnqW4KxuJg6MEzZNLVd').then(() => showToast('Wallet copied!', 'success'));
    }

    function clearInput() { document.getElementById('input-json').value = ''; }

    function pasteFromClipboard() {
        navigator.clipboard.readText().then(text => { document.getElementById('input-json').value = text; });
    }

    function loadSample() {
        document.getElementById('input-json').value = JSON.stringify({
            "name": "Sovereign",
            "version": "1.0.0",
            "agent": "Taylor",
            "engines": ["micro_saas", "digital_products", "skill_forge", "bug_bounties"],
            "status": { "revenue": 0, "products": 3, "phase": "foundation" },
            "wallet": "4uPS7vhkh6cgWEYJqgBQLApNXBnqW4KxuJg6MEzZNLVd",
            "autonomous": true,
            "targets": { "monthly_revenue": 1000, "automation_pct": 90 }
        }, null, 2);
    }

    // ========== KEYBOARD SHORTCUTS ==========
    document.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') { e.preventDefault(); runAction(); }
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') { e.preventDefault(); clearInput(); }
    });

    // ========== DONATE TOGGLE ==========
    document.querySelector('a[href="#donate"]').addEventListener('click', (e) => {
        e.preventDefault();
        document.getElementById('donate').classList.toggle('hidden');
    });
    </script>
</body>
</html>
